/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __defProps = Object.defineProperties;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
__export(exports, {
  default: () => CustomModalsPlugin
});
var import_obsidian2 = __toModule(require("obsidian"));

// src/filesManager/FilesManager.ts
var FilesManager = class {
  constructor(app2) {
    this.app = app2;
  }
  getExtraFileData(file) {
    return __async(this, null, function* () {
      var _a;
      return __spreadProps(__spreadValues({}, file), {
        frontmatter: (_a = this.app.metadataCache.getFileCache(file)) == null ? void 0 : _a.frontmatter,
        contents: yield this.app.vault.cachedRead(file)
      });
    });
  }
  getModalFiles() {
    return __async(this, null, function* () {
      const root = this.app.vault.getRoot();
      const modalsFolder = __spreadValues({
        children: [],
        isRoot: () => false
      }, root.children.find((child) => child.name === "modals"));
      const modalFiles = modalsFolder.children.map((child) => app.vault.getAbstractFileByPath(child.path));
      return yield Promise.all(modalFiles.map((file) => __async(this, null, function* () {
        const extraData = yield this.getExtraFileData(file);
        return extraData;
      })));
    });
  }
};
var FilesManager_default = FilesManager;

// src/modal/CustomModal.ts
var import_obsidian = __toModule(require("obsidian"));
var CustomModal = class extends import_obsidian.Modal {
  constructor(plugin, customModalSettings) {
    super(plugin.app);
    this.plugin = plugin;
    this.customModalSettings = customModalSettings;
  }
  handleCallFunction(func2, args) {
    return __async(this, null, function* () {
      const isAsync = func2.constructor.name === "AsyncFunction";
      if (isAsync) {
        yield func2(...args);
      } else {
        func2(...args);
      }
    });
  }
  renderModal(ctx, obsidian) {
    this.titleEl.createEl("span", {
      text: this.customModalSettings.title
    });
    this.contentEl.createDiv({
      cls: "custom-modal-content"
    }).innerHTML = this.customModalSettings.content;
    const okButton = document.createElement("button");
    const okText = document.createTextNode(this.customModalSettings.okText);
    okButton.appendChild(okText);
    okButton.setAttribute("class", "modal-ok-btn");
    const cancelButton = document.createElement("button");
    const cancelText = document.createTextNode(this.customModalSettings.cancelText);
    cancelButton.appendChild(cancelText);
    cancelButton.setAttribute("class", "modal-cancel-btn");
    this.attatchEventListeners(ctx, obsidian, okButton, cancelButton);
    const modalFooter = this.contentEl.createDiv({
      cls: "custom-modal-footer"
    });
    modalFooter.appendChild(okButton);
    modalFooter.appendChild(cancelButton);
  }
  attatchEventListeners(ctx, obsidian, okButton, cancelButton) {
    this.plugin.registerDomEvent(okButton, "click", () => __async(this, null, function* () {
      if (this.customModalSettings.handleOk)
        this.customModalSettings.handleOk(ctx, obsidian);
      this.close();
    }));
    this.plugin.registerDomEvent(cancelButton, "click", () => __async(this, null, function* () {
      if (this.customModalSettings.handleCancel)
        this.customModalSettings.handleCancel(ctx, obsidian);
      this.close();
    }));
  }
  resetModal() {
    this.clearModalContent();
  }
  clearModalContent() {
    this.titleEl.innerText = "";
    this.contentEl.innerHTML = "";
  }
  onOpen() {
    return __async(this, null, function* () {
      const ctx = this.customModalSettings.ctx;
      const obsidian = {
        app: this.app,
        plugin: this.plugin,
        Notice: import_obsidian.Notice
      };
      try {
        yield this.customModalSettings.preRender(ctx, obsidian);
        this.renderModal(ctx, obsidian);
        this.customModalSettings.postRender(ctx, obsidian);
      } catch (err) {
        console.error(err);
      }
    });
  }
  onClose() {
    this.resetModal();
  }
};
var CustomModal_default = CustomModal;

// src/modal/CustomModalSettings.ts
var CustomModalSettings = class {
  constructor({
    title,
    content = "",
    okText = "Ok",
    cancelText = "Cancel",
    handleOk = () => {
    },
    handleCancel = () => {
    },
    preRender = () => {
    },
    postRender = () => {
    }
  }) {
    this.title = title;
    this.content = content;
    this.okText = okText;
    this.cancelText = cancelText;
    this.handleOk = handleOk;
    this.handleCancel = handleCancel;
    this.postRender = postRender;
    this.preRender = preRender;
    this.ctx = {};
  }
};

// src/modalFileParser/ModalFileParser.ts
var ModalFileParser = class {
  constructor() {
    this.contents = "";
  }
  selectBetweenStrings(str, start, end) {
    return str.substring(str.indexOf(start) + 1, str.lastIndexOf(end));
  }
  parseHtmlBlocks() {
    const { contents: contents2 } = this;
    const matcher2 = /^```(?:js|html)\n([\s\S]*?)```$/gm;
    const matches2 = contents2.match(matcher2);
    if (matches2)
      return matches2.map((match2) => {
        const matchTrimmed2 = match2.trim();
        const matchTrimmedLength2 = matchTrimmed2.length;
        const betweenCodeBlock2 = matchTrimmed2.substring(7, matchTrimmedLength2 - 3);
        const removedNewLines = betweenCodeBlock2.replace(/[\t\n]+/g, "");
        return removedNewLines;
      });
    return [];
  }
  parseJavaScriptBlocks() {
    const { contents } = this;
    const matcher = /^```(?:js|javascript)\n([\s\S]*?)```$/gm;
    const matches = contents.match(matcher);
    if (matches) {
      return matches.map((match) => {
        const matchTrimmed = match.trim();
        const matchTrimmedLength = matchTrimmed.length;
        const betweenCodeBlock = matchTrimmed.substring(13, matchTrimmedLength - 3);
        try {
          const func = eval(`async (ctx, obsidian) => { ${betweenCodeBlock} }`);
          return func;
        } catch (err) {
          console.error(err);
          return new Function("ctx", "obsidian", "return;");
        }
      });
    }
    return [];
  }
  parse(contents2) {
    this.contents = contents2 || "";
    const htmlBlocks = this.parseHtmlBlocks();
    const jsBlocks = this.parseJavaScriptBlocks();
    return {
      htmlBlocks,
      jsBlocks
    };
  }
};
var ModalFileParser_default = ModalFileParser;

// src/modalsManager/ModalsManager.ts
var ModalsManager = class {
  constructor(plugin, app2) {
    this.modals = {};
    this.modalSettings = {};
    this.modalFileParser = new ModalFileParser_default();
    this.plugin = plugin;
    this.app = app2;
  }
  createModalSettingsFromFile(file) {
    var _a, _b, _c;
    const { jsBlocks, htmlBlocks } = this.modalFileParser.parse(file.contents);
    const modalSettings = new CustomModalSettings({
      title: (_a = file.frontmatter) == null ? void 0 : _a.title,
      content: htmlBlocks.length ? htmlBlocks[0] : "",
      okText: (_b = file.frontmatter) == null ? void 0 : _b.okText,
      cancelText: (_c = file == null ? void 0 : file.frontmatter) == null ? void 0 : _c.cancelText,
      handleOk: jsBlocks.length ? jsBlocks[0] : void 0,
      handleCancel: jsBlocks.length > 1 ? jsBlocks[1] : void 0,
      preRender: jsBlocks.length > 2 ? jsBlocks[2] : void 0,
      postRender: jsBlocks.length > 3 ? jsBlocks[3] : void 0
    });
    this.modalSettings[file.path] = modalSettings;
  }
  createModalSettingsFromFilesData(allFiles) {
    allFiles.forEach((file) => {
      if (file.path.startsWith("modals/")) {
        this.createModalSettingsFromFile(file);
      }
    });
  }
  addModalCommand(path, modalSettings) {
    this.plugin.addCommand({
      id: `open-modal-${path.split("/")[1]}`,
      name: `Open ${modalSettings.title || "Modal"}`,
      callback: () => {
        this.modals[path].open();
      }
    });
  }
  createModals(allFiles) {
    this.createModalSettingsFromFilesData(allFiles);
    Object.entries(this.modalSettings).forEach(([path, modalSettings]) => {
      if (!modalSettings.title)
        return;
      this.modals[path] = new CustomModal_default(this.plugin, modalSettings);
      this.addModalCommand(path, modalSettings);
    });
  }
  createModal(file) {
    this.createModalSettingsFromFile(file);
    const settings = this.modalSettings[file.path];
    if (!settings.title)
      return;
    this.modals[file.path] = new CustomModal_default(this.plugin, this.modalSettings[file.path]);
    this.addModalCommand(file.path, this.modalSettings[file.path]);
  }
};
var ModalsManager_default = ModalsManager;

// src/main.ts
var CustomModalsPlugin = class extends import_obsidian2.Plugin {
  constructor(app2, manifest) {
    super(app2, manifest);
    this.filesManager = new FilesManager_default(app2);
    this.modalsManager = new ModalsManager_default(this, app2);
    this.handleCreateAndModify = this.handleCreateAndModify.bind(this);
    this.handleCacheResolve = this.handleCacheResolve.bind(this);
  }
  handleCreateAndModify(file) {
    return __async(this, null, function* () {
      if (file.path.startsWith("modals/")) {
        const extraData = yield this.filesManager.getExtraFileData(file);
        this.modalsManager.createModal(extraData);
      }
    });
  }
  handleCacheResolve(file) {
    return __async(this, null, function* () {
      if (file.path.startsWith("modals/")) {
        const extraData = yield this.filesManager.getExtraFileData(file);
        this.modalsManager.createModal(extraData);
      }
    });
  }
  onload() {
    return __async(this, null, function* () {
      const modalFiles = yield this.filesManager.getModalFiles();
      modalFiles.forEach((file) => {
        this.modalsManager.createModal(file);
      });
      this.registerEvent(this.app.vault.on("create", this.handleCreateAndModify));
      this.registerEvent(this.app.vault.on("modify", this.handleCreateAndModify));
      this.registerEvent(this.app.metadataCache.on("resolve", this.handleCacheResolve));
      console.log("Loaded Custom Modals");
    });
  }
  onunload() {
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2ZpbGVzTWFuYWdlci9GaWxlc01hbmFnZXIudHMiLCAic3JjL21vZGFsL0N1c3RvbU1vZGFsLnRzIiwgInNyYy9tb2RhbC9DdXN0b21Nb2RhbFNldHRpbmdzLnRzIiwgInNyYy9tb2RhbEZpbGVQYXJzZXIvTW9kYWxGaWxlUGFyc2VyLnRzIiwgInNyYy9tb2RhbHNNYW5hZ2VyL01vZGFsc01hbmFnZXIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IFBsdWdpbiwgUGx1Z2luTWFuaWZlc3QsIEFwcCwgVEFic3RyYWN0RmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5pbXBvcnQgRmlsZXNNYW5hZ2VyIGZyb20gXCIuL2ZpbGVzTWFuYWdlci9GaWxlc01hbmFnZXJcIjtcclxuaW1wb3J0IE1vZGFsc01hbmFnZXIgZnJvbSBcIi4vbW9kYWxzTWFuYWdlci9Nb2RhbHNNYW5hZ2VyXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDdXN0b21Nb2RhbHNQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG5cdGZpbGVzTWFuYWdlcjogRmlsZXNNYW5hZ2VyO1xyXG5cdG1vZGFsc01hbmFnZXI6IE1vZGFsc01hbmFnZXI7XHJcblxyXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBtYW5pZmVzdDogUGx1Z2luTWFuaWZlc3QpIHtcclxuXHRcdHN1cGVyKGFwcCwgbWFuaWZlc3QpO1xyXG5cclxuXHRcdHRoaXMuZmlsZXNNYW5hZ2VyID0gbmV3IEZpbGVzTWFuYWdlcihhcHApO1xyXG5cdFx0dGhpcy5tb2RhbHNNYW5hZ2VyID0gbmV3IE1vZGFsc01hbmFnZXIodGhpcywgYXBwKTtcclxuXHJcblx0XHR0aGlzLmhhbmRsZUNyZWF0ZUFuZE1vZGlmeSA9IHRoaXMuaGFuZGxlQ3JlYXRlQW5kTW9kaWZ5LmJpbmQodGhpcyk7XHJcblx0XHR0aGlzLmhhbmRsZUNhY2hlUmVzb2x2ZSA9IHRoaXMuaGFuZGxlQ2FjaGVSZXNvbHZlLmJpbmQodGhpcyk7XHJcblx0fVxyXG5cclxuXHRhc3luYyBoYW5kbGVDcmVhdGVBbmRNb2RpZnkoZmlsZTogVEFic3RyYWN0RmlsZSkge1xyXG5cdFx0aWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKFwibW9kYWxzL1wiKSkge1xyXG5cdFx0XHRjb25zdCBleHRyYURhdGEgPSBhd2FpdCB0aGlzLmZpbGVzTWFuYWdlci5nZXRFeHRyYUZpbGVEYXRhKFxyXG5cdFx0XHRcdGZpbGVcclxuXHRcdFx0KTtcclxuXHRcdFx0dGhpcy5tb2RhbHNNYW5hZ2VyLmNyZWF0ZU1vZGFsKGV4dHJhRGF0YSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRhc3luYyBoYW5kbGVDYWNoZVJlc29sdmUoZmlsZTogVEFic3RyYWN0RmlsZSkge1xyXG5cdFx0aWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKFwibW9kYWxzL1wiKSkge1xyXG5cdFx0XHRjb25zdCBleHRyYURhdGEgPSBhd2FpdCB0aGlzLmZpbGVzTWFuYWdlci5nZXRFeHRyYUZpbGVEYXRhKGZpbGUpO1xyXG5cdFx0XHR0aGlzLm1vZGFsc01hbmFnZXIuY3JlYXRlTW9kYWwoZXh0cmFEYXRhKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGFzeW5jIG9ubG9hZCgpIHtcclxuICAgIGNvbnN0IG1vZGFsRmlsZXMgPSBhd2FpdCB0aGlzLmZpbGVzTWFuYWdlci5nZXRNb2RhbEZpbGVzKCk7XHJcbiAgICBtb2RhbEZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcclxuICAgICAgdGhpcy5tb2RhbHNNYW5hZ2VyLmNyZWF0ZU1vZGFsKGZpbGUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gYWxsb3cgbW9kYWxzIHRvIGJlIGluaXRpYWxpemVkIG9uIGZpbGUgY3JlYXRlXHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5hcHAudmF1bHQub24oXCJjcmVhdGVcIiwgdGhpcy5oYW5kbGVDcmVhdGVBbmRNb2RpZnkpKTtcclxuXHJcbiAgICAvLyBhbGxvdyBtb2RhbHMgdG8gYmUgaW5pdGlhbGl6ZWQgb24gZmlsZSBlZGl0XHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5hcHAudmF1bHQub24oXCJtb2RpZnlcIiwgdGhpcy5oYW5kbGVDcmVhdGVBbmRNb2RpZnkpKTtcclxuXHJcbiAgICAvLyBpbml0aWFsaXplIG1vZGFscyBvbiBmaWxlIGNhY2hlIHJlc29sdmUgZm9yIGhhbmRsaW5nIHN0YXJ0dXBcclxuICAgIHRoaXMucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdyZXNvbHZlJywgdGhpcy5oYW5kbGVDYWNoZVJlc29sdmUpKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIkxvYWRlZCBDdXN0b20gTW9kYWxzXCIpO1xyXG5cdH1cclxuXHJcblx0b251bmxvYWQoKTogdm9pZCB7fVxyXG59XHJcbiIsICJpbXBvcnQgeyBBcHAsIFRGb2xkZXIgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuXHJcbmNsYXNzIEZpbGVzTWFuYWdlciB7XHJcbiAgYXBwOiBBcHA7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwKSB7XHJcbiAgICB0aGlzLmFwcCA9IGFwcDtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEV4dHJhRmlsZURhdGEoZmlsZTogYW55KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5maWxlLFxyXG4gICAgICBmcm9udG1hdHRlcjogdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk/LmZyb250bWF0dGVyLFxyXG4gICAgICBjb250ZW50czogYXdhaXQgdGhpcy5hcHAudmF1bHQuY2FjaGVkUmVhZChmaWxlKSxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldE1vZGFsRmlsZXMoKSB7XHJcbiAgICBjb25zdCByb290ID0gdGhpcy5hcHAudmF1bHQuZ2V0Um9vdCgpO1xyXG4gICAgLy8gaGFjayB0aGF0IGxldCdzIHVzIGdldCB0aGUgbW9kYWxzIGZvbGRlciBjaGlsZHJlblxyXG4gICAgY29uc3QgbW9kYWxzRm9sZGVyOiBURm9sZGVyID0geyBcclxuICAgICAgY2hpbGRyZW46IFtdLCBcclxuICAgICAgaXNSb290OiAoKSA9PiBmYWxzZSwgXHJcbiAgICAgIC4uLnJvb3QuY2hpbGRyZW4uZmluZCgoY2hpbGQpID0+IGNoaWxkLm5hbWUgPT09IFwibW9kYWxzXCIpXHJcbiAgICB9O1xyXG4gICAgLy8gZ2V0IGFsbCB0aGUgbW9kYWxzIGZpbGVzXHJcbiAgICBjb25zdCBtb2RhbEZpbGVzID0gbW9kYWxzRm9sZGVyLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoY2hpbGQucGF0aCkpO1xyXG5cclxuICAgIC8vIHJldHVybiB0aGUgbW9kYWwgZmlsZXMgKyBleHRyYSBkYXRhXHJcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwobW9kYWxGaWxlcy5tYXAoYXN5bmMgKGZpbGUpID0+IHtcclxuICAgICAgY29uc3QgZXh0cmFEYXRhID0gYXdhaXQgdGhpcy5nZXRFeHRyYUZpbGVEYXRhKGZpbGUpO1xyXG4gICAgICByZXR1cm4gZXh0cmFEYXRhO1xyXG4gICAgfSkpO1xyXG4gIH1cclxuICBcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRmlsZXNNYW5hZ2VyOyIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBOb3RpY2UsIFBsdWdpbiB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5pbXBvcnQgeyBDdXN0b21Nb2RhbFNldHRpbmdzSW50ZXJmYWNlIH0gZnJvbSBcIi4vQ3VzdG9tTW9kYWxTZXR0aW5nc1wiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBPYnNpZGlhbkFQSSB7XHJcbiAgYXBwOiBBcHAsXHJcbiAgcGx1Z2luOiBQbHVnaW4sXHJcbiAgTm90aWNlOiB0eXBlb2YgTm90aWNlLFxyXG59XHJcblxyXG5jbGFzcyBDdXN0b21Nb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuXHRwbHVnaW46IFBsdWdpbjtcclxuXHRjdXN0b21Nb2RhbFNldHRpbmdzOiBDdXN0b21Nb2RhbFNldHRpbmdzSW50ZXJmYWNlO1xyXG4gIFxyXG5cdGNvbnN0cnVjdG9yKFxyXG5cdFx0cGx1Z2luOiBQbHVnaW4sXHJcblx0XHRjdXN0b21Nb2RhbFNldHRpbmdzOiBDdXN0b21Nb2RhbFNldHRpbmdzSW50ZXJmYWNlXHJcblx0KSB7XHJcblx0XHRzdXBlcihwbHVnaW4uYXBwKTtcclxuXHJcblx0XHR0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuXHRcdHRoaXMuY3VzdG9tTW9kYWxTZXR0aW5ncyA9IGN1c3RvbU1vZGFsU2V0dGluZ3M7XHJcblx0fVxyXG5cclxuXHRhc3luYyBoYW5kbGVDYWxsRnVuY3Rpb24oZnVuYzogYW55LCBhcmdzOiBhbnlbXSkge1xyXG5cdFx0Y29uc3QgaXNBc3luYyA9IGZ1bmMuY29uc3RydWN0b3IubmFtZSA9PT0gXCJBc3luY0Z1bmN0aW9uXCI7XHJcblx0XHRpZiAoaXNBc3luYykge1xyXG5cdFx0XHRhd2FpdCBmdW5jKC4uLmFyZ3MpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0ZnVuYyguLi5hcmdzKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHJlbmRlck1vZGFsKGN0eDogYW55LCBvYnNpZGlhbjogT2JzaWRpYW5BUEkpIHtcclxuXHRcdHRoaXMudGl0bGVFbC5jcmVhdGVFbChcInNwYW5cIiwge1xyXG4gICAgICB0ZXh0OiB0aGlzLmN1c3RvbU1vZGFsU2V0dGluZ3MudGl0bGUsXHJcbiAgICB9KTtcclxuXHJcblx0XHR0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiY3VzdG9tLW1vZGFsLWNvbnRlbnRcIixcclxuXHRcdH0pXHJcblx0XHQvLyB0aGlzIGlzIG5vdCBzZWN1cmUsIGJ1dCB0aGVyZSBpcyBubyBvdGhlciB3YXkgdG8gZG8gaXRcclxuXHRcdC5pbm5lckhUTUwgPSB0aGlzLmN1c3RvbU1vZGFsU2V0dGluZ3MuY29udGVudDtcclxuXHJcblx0XHRjb25zdCBva0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcblx0XHRjb25zdCBva1RleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmN1c3RvbU1vZGFsU2V0dGluZ3Mub2tUZXh0KTtcclxuXHRcdG9rQnV0dG9uLmFwcGVuZENoaWxkKG9rVGV4dCk7XHJcblx0XHRva0J1dHRvbi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1vZGFsLW9rLWJ0blwiKTtcclxuXHJcblx0XHRjb25zdCBjYW5jZWxCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG5cdFx0Y29uc3QgY2FuY2VsVGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMuY3VzdG9tTW9kYWxTZXR0aW5ncy5jYW5jZWxUZXh0KTtcclxuXHRcdGNhbmNlbEJ1dHRvbi5hcHBlbmRDaGlsZChjYW5jZWxUZXh0KTtcclxuXHRcdGNhbmNlbEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1vZGFsLWNhbmNlbC1idG5cIik7XHJcblxyXG4gICAgdGhpcy5hdHRhdGNoRXZlbnRMaXN0ZW5lcnMoY3R4LCBvYnNpZGlhbiwgb2tCdXR0b24sIGNhbmNlbEJ1dHRvbik7XHJcblxyXG5cdFx0Y29uc3QgbW9kYWxGb290ZXIgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiY3VzdG9tLW1vZGFsLWZvb3RlclwiLFxyXG5cdFx0fSlcclxuXHRcdFxyXG5cdFx0bW9kYWxGb290ZXIuYXBwZW5kQ2hpbGQob2tCdXR0b24pO1xyXG5cdFx0bW9kYWxGb290ZXIuYXBwZW5kQ2hpbGQoY2FuY2VsQnV0dG9uKTtcclxuXHR9XHJcblxyXG5cdGF0dGF0Y2hFdmVudExpc3RlbmVycyhjdHg6IGFueSwgb2JzaWRpYW46IE9ic2lkaWFuQVBJLCBva0J1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQsIGNhbmNlbEJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQpIHtcclxuXHRcdHRoaXMucGx1Z2luLnJlZ2lzdGVyRG9tRXZlbnQob2tCdXR0b24sIFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xyXG5cdFx0XHRpZiAodGhpcy5jdXN0b21Nb2RhbFNldHRpbmdzLmhhbmRsZU9rKVxyXG4gICAgICAgIHRoaXMuY3VzdG9tTW9kYWxTZXR0aW5ncy5oYW5kbGVPayhjdHgsIG9ic2lkaWFuKTtcclxuXHRcdFx0dGhpcy5jbG9zZSgpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5wbHVnaW4ucmVnaXN0ZXJEb21FdmVudChjYW5jZWxCdXR0b24sIFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xyXG5cdFx0XHRpZiAodGhpcy5jdXN0b21Nb2RhbFNldHRpbmdzLmhhbmRsZUNhbmNlbClcclxuICAgICAgICB0aGlzLmN1c3RvbU1vZGFsU2V0dGluZ3MuaGFuZGxlQ2FuY2VsKGN0eCwgb2JzaWRpYW4pO1xyXG5cdFx0XHR0aGlzLmNsb3NlKCk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHJlc2V0TW9kYWwoKSB7XHJcblx0XHR0aGlzLmNsZWFyTW9kYWxDb250ZW50KCk7XHJcblx0fVxyXG5cclxuXHRjbGVhck1vZGFsQ29udGVudCgpIHtcclxuXHRcdHRoaXMudGl0bGVFbC5pbm5lclRleHQgPSBcIlwiO1xyXG5cdFx0dGhpcy5jb250ZW50RWwuaW5uZXJIVE1MID0gXCJcIjtcclxuXHR9XHJcblxyXG5cdGFzeW5jIG9uT3BlbigpIHtcclxuXHRcdGNvbnN0IGN0eCA9IHRoaXMuY3VzdG9tTW9kYWxTZXR0aW5ncy5jdHg7XHJcblx0XHRjb25zdCBvYnNpZGlhbjogT2JzaWRpYW5BUEkgPSB7XHJcblx0XHRcdGFwcDogdGhpcy5hcHAsXHJcblx0XHRcdHBsdWdpbjogdGhpcy5wbHVnaW4sXHJcblx0XHRcdE5vdGljZSxcclxuXHRcdH07XHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0YXdhaXQgdGhpcy5jdXN0b21Nb2RhbFNldHRpbmdzLnByZVJlbmRlcihjdHgsIG9ic2lkaWFuKVxyXG5cdFx0XHR0aGlzLnJlbmRlck1vZGFsKGN0eCwgb2JzaWRpYW4pO1xyXG5cdFx0XHR0aGlzLmN1c3RvbU1vZGFsU2V0dGluZ3MucG9zdFJlbmRlcihjdHgsIG9ic2lkaWFuKTtcclxuXHRcdH0gY2F0Y2goZXJyKSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdG9uQ2xvc2UoKTogdm9pZCB7XHJcblx0XHR0aGlzLnJlc2V0TW9kYWwoKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEN1c3RvbU1vZGFsO1xyXG4iLCAiZXhwb3J0IGludGVyZmFjZSBDdXN0b21Nb2RhbFNldHRpbmdzSW50ZXJmYWNlIHtcclxuICB0aXRsZTogc3RyaW5nO1xyXG4gIGNvbnRlbnQ6IHN0cmluZztcclxuICBva1RleHQ/OiBzdHJpbmc7XHJcbiAgY2FuY2VsVGV4dD86IHN0cmluZztcclxuICBoYW5kbGVPaz86IEZ1bmN0aW9uO1xyXG4gIGhhbmRsZUNhbmNlbD86IEZ1bmN0aW9uO1xyXG4gIHByZVJlbmRlcj86IEZ1bmN0aW9uO1xyXG4gIHBvc3RSZW5kZXI/OiBGdW5jdGlvbjtcclxuICBjdHg/OiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDdXN0b21Nb2RhbFNldHRpbmdzIHtcclxuICB0aXRsZTogc3RyaW5nO1xyXG4gIGNvbnRlbnQ6IHN0cmluZztcclxuICBva1RleHQ/OiBzdHJpbmc7XHJcbiAgY2FuY2VsVGV4dD86IHN0cmluZztcclxuICBoYW5kbGVPaz86IEZ1bmN0aW9uO1xyXG4gIGhhbmRsZUNhbmNlbD86IEZ1bmN0aW9uO1xyXG4gIHByZVJlbmRlcj86IEZ1bmN0aW9uO1xyXG4gIHBvc3RSZW5kZXI/OiBGdW5jdGlvbjtcclxuICBjdHg6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3Ioe1xyXG4gICAgdGl0bGUsXHJcbiAgICBjb250ZW50ID0gXCJcIixcclxuICAgIG9rVGV4dCA9IFwiT2tcIixcclxuICAgIGNhbmNlbFRleHQgPSBcIkNhbmNlbFwiLFxyXG4gICAgaGFuZGxlT2sgPSAoKSA9PiB7fSxcclxuICAgIGhhbmRsZUNhbmNlbCA9ICgpID0+IHt9LFxyXG4gICAgcHJlUmVuZGVyID0gKCkgPT4ge30sXHJcbiAgICBwb3N0UmVuZGVyID0gKCkgPT4ge30sXHJcbiAgfTogQ3VzdG9tTW9kYWxTZXR0aW5nc0ludGVyZmFjZSkge1xyXG4gICAgdGhpcy50aXRsZSA9IHRpdGxlO1xyXG4gICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcclxuICAgIHRoaXMub2tUZXh0ID0gb2tUZXh0O1xyXG4gICAgdGhpcy5jYW5jZWxUZXh0ID0gY2FuY2VsVGV4dDtcclxuICAgIHRoaXMuaGFuZGxlT2sgPSBoYW5kbGVPaztcclxuICAgIHRoaXMuaGFuZGxlQ2FuY2VsID0gaGFuZGxlQ2FuY2VsO1xyXG4gICAgdGhpcy5wb3N0UmVuZGVyID0gcG9zdFJlbmRlcjtcclxuICAgIHRoaXMucHJlUmVuZGVyID0gcHJlUmVuZGVyO1xyXG4gICAgdGhpcy5jdHggPSB7fTtcclxuICB9XHJcbn0iLCAiY2xhc3MgTW9kYWxGaWxlUGFyc2VyIHtcclxuXHRjb250ZW50czogc3RyaW5nO1xyXG5cclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMuY29udGVudHMgPSBcIlwiO1xyXG5cdH1cclxuXHJcblx0c2VsZWN0QmV0d2VlblN0cmluZ3Moc3RyOiBzdHJpbmcsIHN0YXJ0OiBzdHJpbmcsIGVuZDogc3RyaW5nKSB7XHJcblx0XHRyZXR1cm4gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihzdGFydCkgKyAxLCBzdHIubGFzdEluZGV4T2YoZW5kKSk7XHJcblx0fVxyXG5cclxuXHRwYXJzZUh0bWxCbG9ja3MoKSB7XHJcblx0XHRjb25zdCB7IGNvbnRlbnRzIH0gPSB0aGlzO1xyXG5cclxuXHRcdGNvbnN0IG1hdGNoZXIgPSAvXmBgYCg/OmpzfGh0bWwpXFxuKFtcXHNcXFNdKj8pYGBgJC9nbTtcclxuXHRcdGNvbnN0IG1hdGNoZXMgPSBjb250ZW50cy5tYXRjaChtYXRjaGVyKTtcclxuXHJcblx0XHRpZiAobWF0Y2hlcylcclxuXHRcdFx0cmV0dXJuIG1hdGNoZXMubWFwKChtYXRjaCkgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IG1hdGNoVHJpbW1lZCA9IG1hdGNoLnRyaW0oKTtcclxuXHRcdFx0XHRjb25zdCBtYXRjaFRyaW1tZWRMZW5ndGggPSBtYXRjaFRyaW1tZWQubGVuZ3RoO1xyXG5cdFx0XHRcdGNvbnN0IGJldHdlZW5Db2RlQmxvY2sgPSBtYXRjaFRyaW1tZWQuc3Vic3RyaW5nKFxyXG5cdFx0XHRcdFx0NyxcclxuXHRcdFx0XHRcdG1hdGNoVHJpbW1lZExlbmd0aCAtIDNcclxuXHRcdFx0XHQpO1xyXG5cdFx0XHRcdGNvbnN0IHJlbW92ZWROZXdMaW5lcyA9IGJldHdlZW5Db2RlQmxvY2sucmVwbGFjZShcclxuXHRcdFx0XHRcdC9bXFx0XFxuXSsvZyxcclxuXHRcdFx0XHRcdFwiXCJcclxuXHRcdFx0XHQpO1xyXG5cdFx0XHRcdHJldHVybiByZW1vdmVkTmV3TGluZXM7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdHJldHVybiBbXTtcclxuXHR9XHJcblxyXG5cdHBhcnNlSmF2YVNjcmlwdEJsb2NrcygpIHtcclxuXHRcdGNvbnN0IHsgY29udGVudHMgfSA9IHRoaXM7XHJcblxyXG5cdFx0Y29uc3QgbWF0Y2hlciA9IC9eYGBgKD86anN8amF2YXNjcmlwdClcXG4oW1xcc1xcU10qPylgYGAkL2dtO1xyXG5cdFx0Y29uc3QgbWF0Y2hlcyA9IGNvbnRlbnRzLm1hdGNoKG1hdGNoZXIpO1xyXG5cclxuXHRcdGlmIChtYXRjaGVzKSB7XHJcblx0XHRcdHJldHVybiBtYXRjaGVzLm1hcCgobWF0Y2gpID0+IHtcclxuXHRcdFx0XHRjb25zdCBtYXRjaFRyaW1tZWQgPSBtYXRjaC50cmltKCk7XHJcblx0XHRcdFx0Y29uc3QgbWF0Y2hUcmltbWVkTGVuZ3RoID0gbWF0Y2hUcmltbWVkLmxlbmd0aDtcclxuXHRcdFx0XHRjb25zdCBiZXR3ZWVuQ29kZUJsb2NrID0gbWF0Y2hUcmltbWVkLnN1YnN0cmluZyhcclxuXHRcdFx0XHRcdDEzLFxyXG5cdFx0XHRcdFx0bWF0Y2hUcmltbWVkTGVuZ3RoIC0gM1xyXG5cdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHRjb25zdCBmdW5jID0gZXZhbChgYXN5bmMgKGN0eCwgb2JzaWRpYW4pID0+IHsgJHtiZXR3ZWVuQ29kZUJsb2NrfSB9YCk7XHJcblx0XHRcdFx0XHRyZXR1cm4gZnVuYztcclxuXHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcclxuXHRcdFx0XHRcdC8vIGRvIG5vdGhpbmcgd2l0aCBlcnJvciB0byBub3QgZmlsbCB1cCB0aGUgZGV2IGNvbnNvbGUuXHJcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XHJcblx0XHRcdFx0XHQvLyBzdHViIGZ1bmN0aW9uXHJcblx0XHRcdFx0XHRyZXR1cm4gbmV3IEZ1bmN0aW9uKFwiY3R4XCIsIFwib2JzaWRpYW5cIiwgXCJyZXR1cm47XCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIFtdO1xyXG5cdH1cclxuXHJcblx0cGFyc2UoY29udGVudHM6IHN0cmluZykge1xyXG5cdFx0dGhpcy5jb250ZW50cyA9IGNvbnRlbnRzIHx8IFwiXCI7XHJcblxyXG5cdFx0Y29uc3QgaHRtbEJsb2NrcyA9IHRoaXMucGFyc2VIdG1sQmxvY2tzKCk7XHJcblx0XHRjb25zdCBqc0Jsb2NrcyA9IHRoaXMucGFyc2VKYXZhU2NyaXB0QmxvY2tzKCk7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0aHRtbEJsb2NrcyxcclxuXHRcdFx0anNCbG9ja3MsXHJcblx0XHR9O1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgTW9kYWxGaWxlUGFyc2VyO1xyXG4iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW4gfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IEN1c3RvbU1vZGFsIGZyb20gXCJzcmMvbW9kYWwvQ3VzdG9tTW9kYWxcIjtcclxuaW1wb3J0IHsgQ3VzdG9tTW9kYWxTZXR0aW5ncyB9IGZyb20gXCJzcmMvbW9kYWwvQ3VzdG9tTW9kYWxTZXR0aW5nc1wiO1xyXG5pbXBvcnQgTW9kYWxGaWxlUGFyc2VyIGZyb20gXCJzcmMvbW9kYWxGaWxlUGFyc2VyL01vZGFsRmlsZVBhcnNlclwiO1xyXG5cclxuY2xhc3MgTW9kYWxzTWFuYWdlciB7XHJcbiAgbW9kYWxzOiBhbnkgPSB7fTtcclxuICBtb2RhbFNldHRpbmdzOiBhbnkgPSB7fTtcclxuICBtb2RhbEZpbGVQYXJzZXI6IE1vZGFsRmlsZVBhcnNlciA9IG5ldyBNb2RhbEZpbGVQYXJzZXIoKTtcclxuXHJcbiAgcGx1Z2luOiBQbHVnaW47XHJcbiAgYXBwOiBBcHA7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogUGx1Z2luLCBhcHA6IEFwcCkge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgICB0aGlzLmFwcCA9IGFwcDtcclxuICB9XHJcblxyXG4gIGNyZWF0ZU1vZGFsU2V0dGluZ3NGcm9tRmlsZShmaWxlOiBhbnkpIHtcclxuICAgIGNvbnN0IHsganNCbG9ja3MsIGh0bWxCbG9ja3MgfSA9IHRoaXMubW9kYWxGaWxlUGFyc2VyLnBhcnNlKGZpbGUuY29udGVudHMpO1xyXG5cclxuICAgIGNvbnN0IG1vZGFsU2V0dGluZ3MgPSBuZXcgQ3VzdG9tTW9kYWxTZXR0aW5ncyh7XHJcbiAgICAgIHRpdGxlOiBmaWxlLmZyb250bWF0dGVyPy50aXRsZSxcclxuICAgICAgY29udGVudDogaHRtbEJsb2Nrcy5sZW5ndGggPyBodG1sQmxvY2tzWzBdIDogXCJcIixcclxuICAgICAgb2tUZXh0OiBmaWxlLmZyb250bWF0dGVyPy5va1RleHQsXHJcbiAgICAgIGNhbmNlbFRleHQ6IGZpbGU/LmZyb250bWF0dGVyPy5jYW5jZWxUZXh0LFxyXG4gICAgICBoYW5kbGVPazoganNCbG9ja3MubGVuZ3RoID8ganNCbG9ja3NbMF0gOiB1bmRlZmluZWQsXHJcbiAgICAgIGhhbmRsZUNhbmNlbDoganNCbG9ja3MubGVuZ3RoID4gMSA/IGpzQmxvY2tzWzFdIDogdW5kZWZpbmVkLFxyXG4gICAgICBwcmVSZW5kZXI6IGpzQmxvY2tzLmxlbmd0aCA+IDIgPyBqc0Jsb2Nrc1syXSA6IHVuZGVmaW5lZCxcclxuICAgICAgcG9zdFJlbmRlcjoganNCbG9ja3MubGVuZ3RoID4gMyA/IGpzQmxvY2tzWzNdIDogdW5kZWZpbmVkLFxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLm1vZGFsU2V0dGluZ3NbZmlsZS5wYXRoXSA9IG1vZGFsU2V0dGluZ3M7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVNb2RhbFNldHRpbmdzRnJvbUZpbGVzRGF0YShhbGxGaWxlczogYW55KSB7XHJcbiAgICBhbGxGaWxlcy5mb3JFYWNoKChmaWxlOiBhbnkpID0+IHtcclxuICAgICAgaWYgKGZpbGUucGF0aC5zdGFydHNXaXRoKFwibW9kYWxzL1wiKSkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTW9kYWxTZXR0aW5nc0Zyb21GaWxlKGZpbGUpO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcblxyXG4gIGFkZE1vZGFsQ29tbWFuZChwYXRoOiBzdHJpbmcsIG1vZGFsU2V0dGluZ3M6IEN1c3RvbU1vZGFsU2V0dGluZ3MpIHtcclxuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xyXG4gICAgICBpZDogYG9wZW4tbW9kYWwtJHtwYXRoLnNwbGl0KCcvJylbMV19YCxcclxuICAgICAgbmFtZTogYE9wZW4gJHttb2RhbFNldHRpbmdzLnRpdGxlIHx8IFwiTW9kYWxcIn1gLFxyXG4gICAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubW9kYWxzW3BhdGhdLm9wZW4oKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVNb2RhbHMoYWxsRmlsZXM6IGFueSkge1xyXG4gICAgLy8gY3JlYXRlIHNldHRpbmdzXHJcbiAgICB0aGlzLmNyZWF0ZU1vZGFsU2V0dGluZ3NGcm9tRmlsZXNEYXRhKGFsbEZpbGVzKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgbW9kYWxzIGZyb20gc2V0dGluZ3NcclxuICAgIE9iamVjdC5lbnRyaWVzKHRoaXMubW9kYWxTZXR0aW5ncykuZm9yRWFjaCgoW3BhdGgsIG1vZGFsU2V0dGluZ3NdKSA9PiB7XHJcbiAgICAgIGlmICghbW9kYWxTZXR0aW5ncy50aXRsZSlcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgICAgXHJcbiAgICAgIHRoaXMubW9kYWxzW3BhdGhdID0gbmV3IEN1c3RvbU1vZGFsKHRoaXMucGx1Z2luLCBtb2RhbFNldHRpbmdzKTtcclxuICAgICAgdGhpcy5hZGRNb2RhbENvbW1hbmQocGF0aCwgbW9kYWxTZXR0aW5ncyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZU1vZGFsKGZpbGU6IGFueSkge1xyXG4gICAgdGhpcy5jcmVhdGVNb2RhbFNldHRpbmdzRnJvbUZpbGUoZmlsZSk7XHJcbiAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMubW9kYWxTZXR0aW5nc1tmaWxlLnBhdGhdO1xyXG4gICAgXHJcbiAgICBpZiAoIXNldHRpbmdzLnRpdGxlKVxyXG4gICAgICByZXR1cm47XHJcblxyXG4gICAgdGhpcy5tb2RhbHNbZmlsZS5wYXRoXSA9IG5ldyBDdXN0b21Nb2RhbCh0aGlzLnBsdWdpbiwgdGhpcy5tb2RhbFNldHRpbmdzW2ZpbGUucGF0aF0pO1xyXG4gICAgdGhpcy5hZGRNb2RhbENvbW1hbmQoZmlsZS5wYXRoLCB0aGlzLm1vZGFsU2V0dGluZ3NbZmlsZS5wYXRoXSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBNb2RhbHNNYW5hZ2VyOyJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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
